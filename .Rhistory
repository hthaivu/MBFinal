) %>%
filter(!is.na(totalAssets)) %>%
mutate(totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold) %>%
arrange(desc(totalAssets))
cdsBHC = bhcData %>%
filter(!cdsNetBuy==0) %>%
mutate(logCDSBought = log(cdsBought), logCDSSold = log(cdsSold)) %>%
arrange(desc(cdsNetBuy))
bhcDataAll = data.frame()
for (year in 2017:2017){
for (quarter in 4:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
date = RSSD9054,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold) %>%
arrange(desc(totalAssets))
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
}
View(bhcDataAll)
bhcData = bhcDataAll
cdsBHC = bhcData %>%
filter(!cdsNetBuy==0) %>%
mutate(logCDSBought = log(cdsBought), logCDSSold = log(cdsSold)) %>%
arrange(desc(cdsNetBuy))
bhcDataAll = data.frame()
for (year in 2017:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
date = RSSD9054,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold) %>%
arrange(desc(totalAssets))
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
}
pb <- txtProgressBar(min = 0, max = total, style = 3)
for(i in 1:total){
Sys.sleep(0.1)
# update progress bar
setTxtProgressBar(pb, i)
}
close(pb)
total = 100
pb <- txtProgressBar(min = 0, max = total, style = 3)
for(i in 1:total){
Sys.sleep(0.1)
# update progress bar
setTxtProgressBar(pb, i)
}
close(pb)
2017-1995
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 1996, max = 2017, style = 3)
for (year in 1996:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
setTxtProgressBar(pb, year)
}
close(pb)
year
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 1996, max = 2017, style = 3)
for (year in 1999:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
setTxtProgressBar(pb, year)
}
close(pb)
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 1996, max = 2017, style = 3)
for (year in 2004:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
setTxtProgressBar(pb, year)
}
close(pb)
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 1996, max = 2017, style = 3)
for (year in 2006:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
setTxtProgressBar(pb, year)
}
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 1996, max = 2017, style = 3)
suppressMessages()
for (year in 2006:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
setTxtProgressBar(pb, year)
}
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 1996, max = 2017, style = 3)
sink(NULL);
for (year in 2006:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb")
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
setTxtProgressBar(pb, year)
}
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 1996, max = 2017, style = 3)
for (year in 2006:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
suppressMessages(download.file(url,temp,mode="wb"))
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
setTxtProgressBar(pb, year)
}
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 1996, max = 2017, style = 3)
for (year in 2006:2017){
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb",quiet=TRUE)
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
setTxtProgressBar(pb, year)
}
bhcDataAll = data.frame()
pb <- txtProgressBar(min = 2006, max = 2017, style = 3)
for (year in 2006:2017){
setTxtProgressBar(pb, year)
year
for (quarter in 1:4){
temp <- tempfile()
# Create url
url = paste("https://www.chicagofed.org/api/sitecore/BHCHome/GetFile?searchbox=Search&searchbox=&people_filter_name=-+Name+-&people_filter_role=-+Role+-
&people_filter_team=-+Team+-&SelectedYear=",year,sep="")
url = paste(url,"&SelectedQuarter=",sep="")
url = paste(url,quarter,sep="")
# Download
temp = "temp.zip"
download.file(url,temp,mode="wb",quiet=TRUE)
tempData <- read.table(unzip(temp),sep="^", nrows=1300, comment.char="", header=TRUE, quote="", na.strings="--------", as.is=TRUE)
unlink(temp)
# Select
bhcDataTemp = tempData %>%
select(bankName = RSSD9017,
totalAssets = BHCK2170,
totalLoans = BHCK2122,
loansCI_US = BHCK1763,
loansCI_foreign = BHCK1764,
cdsSold = BHCKC968,
cdsBought = BHCKC969
) %>%
filter(!is.na(totalAssets)) %>%
mutate(year = year, quarter = quarter, totalCI = loansCI_US + loansCI_foreign, cdsNetBuy = cdsBought - cdsSold)
# Combine
bhcDataAll = rbind(bhcDataAll,bhcDataTemp)
}
}
close(pb)
View(bhcDataAll)
cdsHolder = bhcDataAll %>%
filter(cdsNetBuy != 0) %>%
group_by(bankName) %>%
summarise(count = N())
cdsHolder = bhcDataAll %>%
filter(cdsNetBuy != 0) %>%
group_by(bankName) %>%
summarise(count = n())
View(cdsHolder)
cdsTimeSeries = bhcDataAll %>%
filter(bankName %in% cdsHolder$bankName)
View(cdsTimeSeries)
cdsSummary = cdsTimeSeries %>%
group_by(bankName) %>%
summarise(count = n())
View(cdsSummary)
cdsSummary = cdsTimeSeries %>%
group_by(bankName,year) %>%
summarise(count = n())
View(bhcDataTemp)
View(cdsSummary)
barclays = bhcDataAll %>%
filter(grepl('Barclays', type))
barclays = bhcDataAll %>%
filter(grepl('Barclays', bankName))
View(barclays)
barclays = bhcDataAll %>%
filter(grepl('BARCLAYS', bankName))
cdsTimeSeries = rbind(cdsTimeSeries,barclays)
cdsSummary = cdsTimeSeries %>%
group_by(bankName,year) %>%
summarise(count = n())
jpMorgan = bhcDataAll %>%
filter(grepl('JPMORGAN', bankName))
View(jpMorgan)
jpMorgan = bhcDataAll %>%
filter(grepl('JPMORGAN', bankName)) %>%
group_by(bankName, year) %>%
summarise(Assets = mean(totalAssets),
Loans = mean(totalLoans),
NetCDS = mean(cdsNetBuy))
ggplot(jpMorgan) +
geom_line(aes(x=year,y=NetCDS))
library(lubridate)
bhcDataAll %>% mutate(year = year(as.Date(as.character(yrs), format = "%Y")))
bhcDataAll %>% mutate(year = year(as.Date(as.character(year), format = "%Y")))
bhcDataAll <- bhcDataAll %>%
mutate(year = year(as.Date(as.character(year), format = "%Y")))
cdsHolder = bhcDataAll %>%
filter(cdsNetBuy != 0) %>%
group_by(bankName) %>%
summarise(count = n())
cdsTimeSeries = bhcDataAll %>%
filter(bankName %in% cdsHolder$bankName)
barclays = bhcDataAll %>%
filter(grepl('BARCLAYS', bankName))
jpMorgan = bhcDataAll %>%
filter(grepl('JPMORGAN', bankName)) %>%
group_by(bankName, year) %>%
summarise(Assets = mean(totalAssets),
Loans = mean(totalLoans),
NetCDS = mean(cdsNetBuy))
ggplot(jpMorgan) +
geom_line(aes(x=year,y=NetCDS))
class(jpMorgan$year)
bhcDataAll <- bhcDataAll %>%
mutate(year = as.Date(as.character(year), format = "%Y"))
cdsHolder = bhcDataAll %>%
filter(cdsNetBuy != 0) %>%
group_by(bankName) %>%
summarise(count = n())
cdsTimeSeries = bhcDataAll %>%
filter(bankName %in% cdsHolder$bankName)
barclays = bhcDataAll %>%
filter(grepl('BARCLAYS', bankName))
jpMorgan = bhcDataAll %>%
filter(grepl('JPMORGAN', bankName)) %>%
group_by(bankName, year) %>%
summarise(Assets = mean(totalAssets),
Loans = mean(totalLoans),
NetCDS = mean(cdsNetBuy))
ggplot(jpMorgan) +
geom_line(aes(x=year,y=NetCDS))
bhcDataAll <- bhcDataAll %>%
mutate(date=as.Date(paste(year, quarter*3,sep="-"), "%Y-%m"))
View(bhcDataAll)
View(bhcDataAll)
bhcDataAll <- bhcDataAll %>%
mutate(date=(paste(year, quarter*3,sep="-"), "%Y-%m"))
bhcDataAll <- bhcDataAll %>%
mutate(date=(paste(year, quarter*3,sep="-")))
bhcDataAll <- bhcDataAll %>%
mutate(date=(paste(year(year), quarter*3,sep="-")))
bhcDataAll <- bhcDataAll %>%
mutate(date=as.Date(paste(year(year), quarter*3,sep="-"), "%Y-%m"))
bhcDataAll <- bhcDataAll %>%
mutate(year = year(year))
bhcDataAll <- bhcDataAll %>%
mutate(mon = quarter * 3) %>%
mutate(date=ymd(sprintf('%04d%02d%02d', year, mon, 1)))
cdsHolder = bhcDataAll %>%
filter(cdsNetBuy != 0) %>%
group_by(bankName) %>%
summarise(count = n())
cdsTimeSeries = bhcDataAll %>%
filter(bankName %in% cdsHolder$bankName)
barclays = bhcDataAll %>%
filter(grepl('BARCLAYS', bankName))
jpMorgan = bhcDataAll %>%
filter(grepl('JPMORGAN', bankName)) %>%
group_by(bankName, date) %>%
summarise(Assets = mean(totalAssets),
Loans = mean(totalLoans),
NetCDS = mean(cdsNetBuy))
ggplot(jpMorgan) +
geom_line(aes(x=year,y=NetCDS))
ggplot(jpMorgan) +
geom_line(aes(x=date,y=NetCDS))
